$.fn.extend({center:function(){this.css("position","fixed");var a=($(window).height()-this.height())/2;if(a<0){a=0}this.css("top",a+"px");this.css("left",($(window).width()-this.width())/2+"px");return this}});$.initPlaceholder=function(){$("input:text").each(function(){if(!$(this).hasClass("initedPlaceholder")&&$(this).attr("placeholder")!=""){$(this).addClass("initedPlaceholder");$(this).val($(this).attr("placeholder"))}})};$.openLightLayer=function(e,d,a,c,b){if($.openLightLayer.count==undefined){$.openLightLayer.count=1}else{$.openLightLayer.count++}$('<div class="lightLayerBackground" id="lightLayerBackground'+$.openLightLayer.count+'"></div><div class="lightLayer '+c+'" id="lightLayer'+$.openLightLayer.count+'"></div>').appendTo("body");layerBG=$("#lightLayerBackground"+$.openLightLayer.count);layerMM=$("#lightLayer"+$.openLightLayer.count);e='<a href="#" class="close">close</a>'+e;layerBG.click(function(){$.closeLightLayer()}).show().css("z-index",9000+$.openLightLayer.count*2-1);if(b!=undefined){layerBG.css("background-color",b)}layerMM.html(e).show().css("z-index",9000+$.openLightLayer.count*2);layerMM.find(".modal").css({width:d-2,height:a-2});if(d!=undefined){layerMM.css("width",d)}if(a!=undefined){layerMM.css("height",a)}layerMM.center();if(!jQuery.support.placeholder){$.initPlaceholder()}layerMM.find(".close").click(function(f){f.preventDefault();$.closeLightLayer()});$(".modal input:text").focus()};$.closeLightLayer=function(){if($.closeLightLayer.lock){return false}$("#lightLayer"+$.openLightLayer.count).hide().remove();$("#lightLayerBackground"+$.openLightLayer.count).hide().remove();$.openLightLayer.count--;$.openLightLayer.lightbox=false};var highlighter=function(){var a=new RegExp(keyword,"g");var b=['<span class="highlight">',keyword,"</span>"].join("");$(".twit_item").each(function(){var c=$(this).html();if(c.indexOf(keyword)>-1){$(this).html(c.replace(a,b))}})};var keyword="";var accounts=[];var initKeyword=function(a){keyword=a;$("#twts").html('<div class="add"><a href="#add" id="account_add">'+keyword+"<br> 알바 트윗계정 추가</a>");$.get("/alba/keyword",{keyword:keyword},function(d,b){accounts=[];try{window.scrollTo(0,0)}catch(f){}$.each(d.accounts,function(g,e){accounts.push(e.id_str);var h="twt_"+e.account;$(['<div id="',h,'"></div>'].join("")).prependTo("#twts");html=['<div class="twit_head"><img src="http://api.twitter.com/1/users/profile_image?screen_name=',e.account,'&size=normal" class="profileimg"><a href="http://twitter.com/',e.account,'" class="twitnickname outlink">',e.nickname,"<em>",e.account,"</em></a></div>"].join("");$(html).prependTo("#"+h)});$("#twts").css("width",$("#twts>div").length*320+100);var c={};if(d.tweets){$.each(d.tweets,function(h,g){html=['<div class="twit_item">',g.text,(g.msg?g.msg:""),'<span class="date">',g.created_at,"</span></div>"].join("");try{c[g.account].push(html)}catch(i){c[g.account]=[html]}})}$.each(c,function(g,e){$(e.join("")).appendTo("#twt_"+g)});highlighter()},"json")};var init=false;$(document).ready(function(){if(init){return}init=true;jQuery.support.placeholder=false;test=document.createElement("input");if("placeholder" in test){jQuery.support.placeholder=true}if(window.location.href.indexOf("#")>0){keyword=window.location.href.substr(window.location.href.indexOf("#")+1);initKeyword(keyword);$("ul.tags li a").removeClass("on");$("ul.tags li a").each(function(){if($(this).html()==keyword){$(this).addClass("on")}})}else{if(window.location.href.indexOf("?")>0){keyword=decodeURI(window.location.href.substr(window.location.href.indexOf("?q=")+3));initKeyword(keyword);$("ul.tags li a").removeClass("on");$("ul.tags li a").each(function(){if($(this).html()==keyword){$(this).addClass("on")}})}else{if($("ul.tags li").length>1){$("ul.tags li:eq(1) a:first").each(function(){$(this).addClass("on");initKeyword($(this).text())})}}}$("#keyword_add").bind("click",function(a){a.preventDefault();$.closeLightLayer();html='<div class="modal"><h3>키워드 추가</h3><form id="newkeywordform"><label for="newkeyword">알바가 창궐하는 인물이름 또는 키워드를 적어주세요</label><input type="text" class="text" id="newkeyword" value="" placeholder="인물이름 또는 키워드"><input type="submit" class="submit" value="추가"></form></div>';$.openLightLayer(html,300,250);$("#newkeywordform").submit(function(){var b=$("#newkeyword").val();if($.trim(b)=="인물이름 또는 키워드"){return false}$(".modal .submit").val("추가중...");$.post("/alba/keyword",{keyword:b},function(d,c){if(d.result=="ok"){$("ul.tags a").removeClass("on");$("ul.tags").append(['<li><a href="/#',b,'" class="on">',b,"</a></li>"].join(""));initKeyword(b);$.closeLightLayer()}else{$.closeLightLayer();initKeyword(b)}},"json");return false})})});$("ul.tags a").live("click",function(a){a.preventDefault();if($(this).hasClass("delete")){return false}var b=$(this).attr("id");if(b=="keyword_add"){return false}$("ul.tags a").removeClass("on");$(this).addClass("on");initKeyword($(this).text())});$("a#account_add").live("click",function(a){a.preventDefault();$.closeLightLayer();if($("#twts>div").length>17){alert("한 키워드에 계정이 너무 많아 브라우저가 느려지고 있습니다. 키워드를 하나 더 만들어 추가해주세요!");return false}html='<div class="modal"><h3>'+keyword+' 알바트윗 추가</h3><form id="newaccountform"><label for="newaccount">'+keyword+'의 알바가 확실한 트위터 아이디를 적어주세요</label><input type="text" class="text" id="newaccount" value="" placeholder="인물이름 또는 키워드"><input type="submit" class="submit" value="추가"></form></div>';$.openLightLayer(html,300,250);$("#newaccountform").submit(function(){var b=$("#newaccount").val().replace("http://","").replace("https://","").replace("@","").replace("#","").replace("!","").replace("/","");if($("#twt_"+b).length>0){alert("이미 있습니다");return false}$(".modal .submit").val("확인중...").addClass("ing");$.post("/alba/account",{keyword:keyword,account:b},function(d,c){if(d.result=="ok"){var e="twt_"+($("#twts>div").length+1);$(['<div id="',e,'"></div>'].join("")).prependTo("#twts");$("#twts").css("width",$("#twts>div").length*320+100);$.closeLightLayer();html=['<div class="twit_head"><img src="http://api.twitter.com/1/users/profile_image?screen_name=',b,'&size=normal" class="profileimg"><a href="http://twitter.com/',b,'" class="twitnickname outlink">',d.nickname,"<em>",b,"</em></a></div>"].join("");$(html).prependTo("#"+e);twts=[];$.each(d.tweets,function(g,f){html=['<div class="twit_item">',f.text,'<span class="date">',f.created_at,"</span></div>"].join("");twts.push(html)});$("#"+e).append(twts.join(""));highlighter()}else{$("#newaccount").show("shake",{distance:3,times:5},30,function(){$(this).focus()});$(".modal label").html("이미 있습니다. 다른 계정을 적어주세요").addClass("r");$(".modal .submit").val("추가").removeClass("ing")}},"json");return false})});var domain=window.location.href.replace(/https|http|:\/\//gi,"").split("/")[0];